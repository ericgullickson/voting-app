# version is now using "compose spec"
# v2 and v3 are now combined!
# docker-compose v1.27+ required

services:
  db:
    tty: true
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - DB=${DB}
      - WORKER=${WORKER}
      - VOTE=${VOTE}
      - RESULT=${RESULT}
      - REDIS=${REDIS}
    extra_hosts:
      - db:${DB}
      - worker:${WORKER}
      - vote:${VOTE}
      - result:${RESULT}
      - redis:${REDIS}
    ports:
      - 5432:5432
    volumes:
      - "db-data:/var/lib/postgresql/data"
      - "./healthchecks:/healthchecks"
    healthcheck:
      test: /healthchecks/postgres.sh
      interval: "5s"
volumes:
  db-data: